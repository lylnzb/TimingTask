<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta http-equiv="Content-Type" content="text/html"; charset="utf-8" />
    <title>栏目管理</title>
    <!--<link rel="stylesheet" href="../treetable-lay/demo/layui/css/layui.css">-->
    <link rel="stylesheet" href="/layui/css/layui.css">
    <link rel="stylesheet" href="/semantic-ui/dist/semantic.min.css">
    <link href="../css/table.css" rel="stylesheet" type="text/css" />
    <link href="../css/animate.css" rel="stylesheet"/>
    <link href="../css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="../css/font-awesome.min.css" rel="stylesheet"/>
    <link href="../css/ry-ui.css" rel="stylesheet"/>
    <style>
        .layui-table-fixed.layui-table-fixed-r .layui-table-body tr{background-color: white}
        .table-striped {height: 95%;}
        .label-primary, .badge-primary {
            background-color: #1ab394;
            color: #FFFFFF;
        }

        .label-success, .badge-success {
            background-color: #1c84c6;
            color: #FFFFFF;
        }

        .label-warning, .badge-warning {
            background-color: #f8ac59;
            color: #FFFFFF;
        }

        .label-warning-light, .badge-warning-light {
            background-color: #f8ac59;
            color: #ffffff;
        }

        .label-danger, .badge-danger {
            background-color: #ed5565;
            color: #FFFFFF;
        }

        .label-info, .badge-info {
            background-color: #23c6c8;
            color: #FFFFFF;
        }

        .label-inverse, .badge-inverse {
            background-color: #262626;
            color: #FFFFFF;
        }

        .label-white, .badge-white {
            background-color: #FFFFFF;
            color: #5E5E5E;
        }

        .label-white, .badge-disable {
            background-color: #2A2E36;
            color: #8B91A0;
        }
    </style>
</head>
<body style="background-color: #ecf0f5;font-family: 微软雅黑;color: #475059;min-width: 1000px;overflow: auto">
<div class="container-div">
    <div class="row">
        <div class="col-sm-12 select-table table-striped">
            <div class="btn-group hidden-xs" role="group" style="margin-top: 10px">
                <a class="btn btn-info" id="addColumn" onclick="addColumn()"><i class="fa fa-plus"></i> 新增栏目</a>
            </div>
            <div class="btn-group hidden-xs" role="group" style="margin-top: 10px">
                <a class="btn btn-danger" id="deleteColumn" onclick="deleteColumn()"><i class="fa fa-trash-o"></i> 批量删除</a>
            </div>
            <table id="demoTreeTb" class="layui-hide" lay-filter="tableEvent" style="margin: 0 auto"></table>
        </div>
    </div>
</div>

<!-- 表格操作列 -->
<div id="tbBar" style="display:none;">
    <a class="btn btn-success btn-xs" lay-event="edit"><i class="fa fa-edit"></i> 编辑</a>
    <a class="btn btn-primary btn-xs" lay-event="del"><i class="fa fa-remove"></i> 删除</a>
</div>

<script type="text/html" id="isHidden">
    <span class='badge badge-primary'>{{ d.typeName}}</span>
</script>

<script type="text/html" id="icon">
    {{ if(d.isDefault == '0'){ }}
        <p style="margin-top: 5px"><i class="{{d.columnIcon}} icon"></i>{{d.columnName}}</p>
    {{ }else { }}
        <p style="margin-top: 5px">{{d.columnName}}</p>
    {{ } }}
</script>

<script type="text/javascript" src="../js/jquery/jQuery-2.2.0.min.js"></script>
<script type="text/javascript" src="../js/bstable/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../js/bstable/js/bootstrap-table.js"></script>
<script type="text/javascript" src="../js/bstable/js/bootstrap-table-zh-CN.min.js"></script>
<script src="../treetable-lay/demo/layui/layui.js"></script>
<script type="text/javascript" src="/common/util.js"></script>
<script>
    var insTb = "";

    layui.config({
        base: '../treetable-lay/'
    }).use(['layer', 'util', 'treeTable'], function () {
        var $ = layui.jquery;
        var layer = layui.layer;
        var util = layui.util;
        var treeTable = layui.treeTable;

        // 渲染表格
        insTb = treeTable.render({
            elem: '#demoTreeTb',
            url: basePath+'webColumn/queryWebColumnInfo',
            height: 'full-70',
            skin:'nob',// 无边框风格
            tree: {
                iconIndex: 2,
                isPidData: true,
                idName: 'columnId',
                pidName: 'parentId'
            },
            cols: [[
                {type: 'checkbox'},
                {title: '序号', type: 'numbers', width: '10%'},
                /*{title: '栏目图标', align: 'center',hide: true},*/
                {title: '栏目名称', minWidth: 165 ,
                    templet: function(d){
                        if(null != d.columnIcon && "*" != d.columnIcon){
                            return "<i class=\""+d.columnIcon+" icon\"></i>"+d.columnName+"";
                        }else{
                            return "<i class=\"file outline icon\"></i>"+d.columnName+"";
                        }
                    }
                },
                {title: '栏目地址', field: 'columnUrl', align: 'center'},
                {title: '栏目属性', field: 'attributeName', align: 'center'},
                {title: '栏目状态', align: 'center', templet: "#isHidden"},
                {title: '创建时间', field: 'createTime', align: 'center'},
                {title: '操作', align: 'center', toolbar: '#tbBar', width: '30%'}
            ]],
            id:"idTest",
            done: function () {
                $(".ew-tree-icon.layui-icon.layui-icon-layer").css("display","none");
                $(".ew-tree-icon.layui-icon.layui-icon-file").css("display","none");
                $('th').css({ 'color': 'black', 'font-weight': 'bold'})//用于设置表头的样式，th即代表表头
                $(".layui-table-box").css("border-width","0px");
                $(".layui-table-header tr").css("height","25px");
                $(".layui-table-header tr span").css("color","#666666");
                $(".layui-table-body tr").css("height","25px");
                $(".layui-form-checkbox").css("style","margin-top: 5px;");
            }
        });

        // 工具列点击事件
        treeTable.on('tool(demoTreeTb)', function (obj) {
            var event = obj.event;
            var data = obj.data;
            if (event === 'del') {
                var lock = false; //默认未锁定
                top.layer.confirm("确定要删除该条栏目数据吗？", {
                    btn: ["确定","取消"], //按钮
                    title: "提示",
                    icon: 3
                }, function(index){
                    if(!lock) {
                        lock = true;
                        var deleteIds = [];
                        deleteIds.push(data.columnId);
                        $.ajax({
                            url:basePath + "webColumn/deleteWebColumnInfo",
                            type:"POST",
                            data:JSON.stringify(deleteIds),
                            dataType:"json",
                            contentType : 'application/json;charset=utf-8',
                            success:function(resultData){
                                if(resultData.code==0){
                                    parent.layer.alert(resultData.msg);
                                    refresh();
                                }else{
                                    parent.layer.alert(resultData.msg);
                                }
                            }
                        });
                    }
                }, function(){

                });
            } else if (event === 'edit') {
                top.layer.open({
                    type: 2,
                    title: '编辑栏目',
                    shadeClose: true,
                    shade: 0.5,
                    closeBtn:1,
                    area: ['780px', '620px'],
                    content: '../admin/column/addOrEditColumn.html?type=update&columnId=' + data.columnId,
                    end: function () {//层消失回调
                        refresh();
                    }
                });
            }
        });

    });

    function addColumn(){
        top.layer.open({
            type: 2,
            title: '添加栏目',
            shadeClose: true,
            shade: 0.5,
            closeBtn:1,
            area: ['750px', '680px'],
            content: '../admin/column/addOrEditColumn.html?type=add',
            end: function () {//层消失回调
                refresh();
            }
        });
    }

    function deleteColumn(){
        var checkedObjs = insTb.checkStatus('idTest');//获取所有选中的节点
        if(checkedObjs.length < 1){
            top.layer.msg("请选择要删除的栏目数据！");
            return false;
        }
        var lock = false; //默认未锁定
        top.layer.confirm("确定要批量删除栏目吗？", {
            btn: ["确定","取消"], //按钮
            title: "提示",
            icon: 3
        }, function(index){
            if(!lock) {
                lock = true;
                var deleteIds = [];
                for(var i = 0;i < checkedObjs.length;i++){
                    deleteIds.push(checkedObjs[i].columnId);
                }
                $.ajax({
                    url:basePath + "webColumn/deleteWebColumnInfo",
                    type:"POST",
                    data:JSON.stringify(deleteIds),
                    dataType:"json",
                    contentType : 'application/json;charset=utf-8',
                    success:function(resultData){
                        if(resultData.code==0){
                            parent.layer.alert(resultData.msg);
                            refresh();
                        }else{
                            parent.layer.alert(resultData.msg);
                        }
                    }
                });
            }
        }, function(){

        });
    }

    function refresh(){
        insTb.refresh();
    }
</script>
</body>
</html>